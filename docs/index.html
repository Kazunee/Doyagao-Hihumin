<!DOCTYPE html>
<html lang="ja">
  
<head>
  <meta charset="utf-8">
  <link href='f0ebf122icon0.png' rel='icon' type='image/x-icon'>
  <title>滝本カットイン</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script type="text/javascript" src="jquery.addText2img.js"></script>
</head>

<script type="text/javascript">
$(function(){

	$('#reset').hide();

	var loc = [{top:18,left:380},{top:18,left:380}];

	var n = 0;
	var font = "UD Digi Kyokasho NP-B";
	var size = "106px";
	var weight = "normal";
	var align = "left";

	$("[name=font]").change(function(){
		font = $('[name=font] option:selected').text();
		$('#text1').css('font-family',font);
	});

	$("[name=size]").change(function(){
		size = $('[name=size] option:selected').text() + 'px';
		$('#text1').css('font-size', size);
	});

	$("[name=weight]").change(function(){
		weight = $('[name=weight] option:selected').text();
		$('#text1').css('font-weight', weight);
	});

	/*
	 * サムネのクリック
	 */
	$(".fkds").click(function(){
	        var path = $(this).attr('src');
		path = path.replace( /-s/g , "");

		$('.addText').attr('src', path);
		n = $(this).data("fkds");
		$('#text1').show();
		$('#text1').css({
			'top':loc[n].top + 'px',
			'left':loc[n].left + 'px'
		});
		$('#make').show();
		$('#reset').hide();
		$('.addText').css('border','none');
	});

	/*
	 * 生成
	 */
	$("#make").click(function(){
		var textset = {
			fillStyle: '#000',
			font: weight + " " + size + " '" + font + "'",
			textAling: 'left',
			textBaseline: 'top',
			x: loc[n].left,
			y: loc[n].top,
			lineHeight: 5	
		};

		var text1 = $('#text1').val();
		$('.addText').addText2img({
			text:    text1,
			textset: textset
		});

		$('#text1').hide();
		$('#make').hide();
		$('#reset').show();

		$('.addText').css('border','dotted 2px #000');
	});

	/*
	 * リセット
	 */
	$("#reset").click(function(){
			
		$('.addText').attr('src', 'hihumi-cutin.png');
		n = 0;
		$('#text1').css({
			'top':loc[n].top,
			'left':loc[n].left
		});

		$('canvas').remove();
		$('#text1').show();
		$('#make').show();
		$('#reset').hide();
		$('.addText').css('border','none');
	});
	
	$('.download a').on('click', function(e){
          var hrefPath = $(this).attr('href');      
          var fileName = $(this).attr('href').replace(/\\/g,'/').replace( /.*\//, '' );
          $target = $(e.target);
          $target.attr({
            download: fileName,
            href: hrefPath
          });
        });
});
</script>
	
<body>
  <h1>滝本カットイン</h1>
  <p>ひふみんがキメ顔でカットインしてるだけのスクリプト</p>
  <p>
    使い方：使用画像を選択した後、テキストボックスに任意の文字を入力して「生成」ボタンを押してください。画像は右クリックから保存できます。なお改行は反映されません。  
  </p>	
  <p>
    ※現時点では日本語二文字程度を表示することしかできません。
  </p>
  <p>
    ※お使いの環境によっては上手く表示されません。
  </p>
  <h3>使用画像を選択（画像クリック）</h3>
	
<section>
	<p>背景：白</p>
	<img src="hihumi-cutin.png" class="fkds" data-fkds="0" />
	<p>背景：透過</p>
	<img src="hihumi-cutin-trans.png" class="fkds" data-fkds="1" />
</section>
	
  <h3>テキストを入力</h3>
  <div style="position:relative">
	<img src="hihumi-cutin.png" class="addText" style="position:relative" />
	<textarea id="text1">断酒</textarea>
  </div>  
　<section>
	<button id="make">生成</button>
	<button id="reset">リセット</button>
	<button id="download"><a href="img.png">保存</a></button>
  </section>

  <hr>

  <p>
    絵＆スクリプト：<a href="https://alserver.jp/@Heyinee" rel="noopener" target="_blank">かず姉</a>
  </p>
	
  <p>
    使用フォント：UDデジタル教科書体 NP-B 太字
  </p>

  <p> 
    <a href="https://github.com/Kazunee/Doyagao-Hihumin" rel="noopener" target="_blank">ソースコード</a>
  </p>
	
</body>
  
</html>
